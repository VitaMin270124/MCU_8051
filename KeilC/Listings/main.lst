A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\main.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE main.a51 SET(SMALL) DEBUG PRINT(.\Listings\main.lst) OBJECT(.\Objects\m
                      ain.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1     ORG 0000H
0000 020030            2             LJMP START        ; Nh?y d?n chuong trình chính
0030                   3     ORG 0030H
                       4     
  00A0                 5     col1            bit P2.0
  00A1                 6     col2            bit P2.1
  00A2                 7     col3            bit P2.2
  00A3                 8     col4            bit P2.3
  00A4                 9     row1            bit P2.4
  00A5                10     row2            bit P2.5
  00A6                11     row3            bit P2.6
  00A7                12     row4            bit P2.7
  0032                13     so1             equ             32h
  0034                14     so2             equ     34h
  0036                15     index   equ             36h
  0038                16     dau             equ             38h
  003A                17     sonhap  equ             3Ah
  003C                18     COL             equ             3Ch
                      19     
  0090                20     RS      EQU P1.0
  0091                21     RW      EQU P1.1
  0092                22     EN      EQU P1.2
  00B0                23     PORT    EQU P3        ; D4–D7 n?i vào P3.4–P3.7
                      24     
0030                  25     START:
0030 753200           26         mov so1, #0
0033 753400           27         mov so2, #0
0036 753800           28         mov dau, #0
0039 753600           29             mov index,#0
003C 31B7             30         ACALL LCD_INIT      ; ? Ch? g?i 1 l?n khi b?t d?u
                      31         
003E 8000             32             SJMP MAIN           ; Nh?y vào vòng l?p chính
                      33             
0040                  34     MAIN:
                      35     
0040 C2A4             36     CLR row1                                                        ; keo cac hang xuong muc th
                             ap
0042 C2A5             37     CLR row2                                                        ; ==> phat hien su kien nha
                             n phim
0044 C2A6             38     CLR row3
0046 C2A7             39     CLR row4
0048 30A00B           40     JNB col1, quetphim                                      ; kiem tra xem cot nao duoc nhan
004B 30A108           41     JNB col2, quetphim
004E 30A205           42     JNB col3, quetphim
0051 30A302           43     JNB col4, quetphim
                      44     
0054 80EA             45     SJMP MAIN                                               ; neu khong co phim nao duoc nhan t
                             hi tiep tuc kiem tra
                      46     
                      47     
0056                  48     quetphim:
0056 5126             49     acall DELAYLCD
0058 116E             50     acall keypad
005A 11E0             51     acall decode
005C 3133             52     acall savenum
005E E53A             53     mov A,sonhap
0060 2430             54     add A,#48
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     2

0062 C0E0             55     PUSH ACC
0064 31DD             56     acall LCD_DATA
0066 D0E0             57     POP ACC
0068 3152             58     acall tinhtoan
006A 5134             59     acall delay
006C 80D2             60     sjmp main
                      61     
                      62     
006E                  63     keypad:
                      64     
006E C2A4             65     clr row1
0070 D2A5             66     setb row2
0072 D2A6             67     setb row3
0074 D2A7             68     setb row4
0076 11BC             69     acall check_col
0078 E53C             70     mov A,COL
007A 6005             71     jz to_row2
007C 14               72     DEC A
                      73     
007D F53A             74     mov sonhap,A
                      75     
007F 803A             76     sjmp ok
                      77     
0081                  78     to_row2:
0081 C2A5             79     clr row2
0083 D2A4             80     setb row1
0085 D2A6             81     setb row3
0087 D2A7             82     setb row4
0089 11BC             83     acall check_col
008B E53C             84     mov A,COL
008D 6006             85     jz to_row3
008F 2403             86     add A,#3
0091 F53A             87     mov sonhap,A
0093 8026             88     sjmp ok
                      89     
0095                  90     to_row3:
0095 C2A6             91     clr row3
0097 D2A4             92     setb row1
0099 D2A5             93     setb row2
009B D2A7             94     setb row4
009D 11BC             95     acall check_col
009F E53C             96     mov A,COL
00A1 6006             97     jz to_row4
00A3 2407             98     add A,#7
00A5 F53A             99     mov sonhap,A
00A7 8012            100     sjmp ok
                     101     
00A9                 102     to_row4:
00A9 C2A7            103     clr row4
00AB D2A4            104     setb row1
00AD D2A5            105     setb row2
00AF D2A6            106     setb row3
00B1 11BC            107     acall check_col
00B3 E53C            108     mov A,COL
00B5 6004            109     jz ok
00B7 240B            110     add A,#11
00B9 F53A            111     mov sonhap,A
00BB 22              112     ok: ret
                     113     
                     114     
00BC                 115     check_col:
00BC 20A005          116     jb col1,check_col2
00BF 753C01          117     mov     COL,#1                                                  ; co phim o Cot 1 duoc nhan
00C2 801B            118     sjmp    finish
00C4                 119     check_col2:
00C4 20A105          120     jb col2,check_col3
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     3

00C7 753C02          121     mov     COL,#2                                                  ;Cot 2
00CA 8013            122     sjmp    finish
00CC                 123     check_col3:
00CC 20A205          124     jb col3,check_col4
00CF 753C03          125     mov     COL,#3                                                  ; Cot 3
00D2 800B            126     sjmp    finish
00D4                 127     check_col4:
00D4 20A305          128     jb col4,no_col
00D7 753C04          129     mov     COL,#4                                                  ;Cot 4
00DA 8003            130     sjmp    finish
00DC                 131     no_col:
00DC 753C00          132     mov     COL,#0                                                  ;khong tim thay phim nao du
                             oc nhan cua 1 Hang
00DF                 133     finish:
00DF 22              134     ret
                     135     
00E0                 136     decode:                                                         ;giai ma thu tu so thanh ca
                             c so
00E0 AB3A            137     mov R3,sonhap
00E2 BB0005          138     cjne R3,#0,c1
00E5 753A07          139     mov sonhap,#7
00E8 8048            140     sjmp done
00EA                 141     c1:
00EA BB0105          142     cjne R3,#1,c2   
00ED 753A08          143     mov sonhap,#8
00F0 8040            144     sjmp done
00F2                 145     c2:
00F2 BB0205          146     cjne R3,#2,c3
00F5 753A09          147     mov sonhap,#9
00F8 8038            148     sjmp done
00FA                 149     c3:
00FA BB0305          150     cjne R3,#3,c7
00FD 753AFF          151     mov sonhap,#255
0100 8030            152     sjmp done
                     153     ;c4:
                     154     ;cjne R3,#3,c5
                     155     ;mov sonhap,#4
                     156     ;sjmp done
                     157     ;c5:
                     158     ;cjne R3,#3,c6
                     159     ;mov sonhap,#5
                     160     ;sjmp done
                     161     ;c6:
                     162     ;cjne R3,#3,c7
                     163     ;mov sonhap,#6
                     164     ;sjmp done
0102                 165     c7:
0102 BB0703          166     cjne R3,#7,c8
0105 753AFA          167     mov sonhap,#250
0108                 168     c8:
0108 BB0803          169     cjne R3,#8,c9
010B 753A01          170     mov sonhap,#1
010E                 171     c9:
010E BB0903          172     cjne R3,#9,c10
0111 753A02          173     mov sonhap,#2
0114                 174     c10:
0114 BB0A03          175     cjne R3,#10,c11
0117 753A03          176     mov sonhap,#3
011A                 177     c11:
011A BB0B03          178     cjne R3,#11,c13
011D 753AFD          179     mov sonhap,#253
0120                 180     c13:
0120 BB0D03          181     cjne R3,#13,c14
0123 753A00          182     mov sonhap,#0
0126                 183     c14:
0126 BB0E03          184     cjne R3,#14,c15
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     4

0129 753A0D          185     mov sonhap,#13
012C                 186     c15:
012C BB0F03          187     cjne R3,#15,done
012F 753AFB          188     mov sonhap,#251
0132 22              189     done: ret
                     190     
0133                 191     savenum:        
0133 AC36            192     mov R4,index                                                    ;luu thu tu so va phep tinh 
0135 BC0007          193     cjne R4,#0,cal                                                  ;luu so thu nhat
0138 853A32          194     mov so1,sonhap
013B 0536            195     inc index
013D 8012            196     jmp fin
013F                 197     cal:
013F BC0107          198     cjne R4,#1,num2
0142 853A38          199     mov dau,sonhap
0145 0536            200     inc index
0147 8008            201     jmp fin
0149                 202     num2:
0149 BC0205          203     cjne R4,#2,fin
014C 853A34          204     mov so2,sonhap
014F 0536            205     inc index 
0151 22              206     fin: ret
                     207     
0152                 208     TINHTOAN:                                                       ;TINH TOAN VA XUAT KET QUA 
                             RA MAN HINH
0152 B43D50          209     CJNE A,#61,DONE1
0155 E538            210     MOV A,DAU
0157 B4FB10          211     CJNE A,#251,TRU
015A E532            212     MOV A,SO1
015C 2534            213     ADD A,SO2
015E FD              214     MOV R5,A
015F 24F6            215     ADD A,#246
0161 4043            216     JC TWODIGIT
0163 ED              217     MOV A,R5
0164 2430            218     ADD A,#48
0166 31DD            219     ACALL LCD_DATA
0168 803B            220     JMP DONE1               
016A                 221     TRU:
016A B4FD10          222     CJNE A,#253,NHAN
016D E532            223     MOV A,SO1
016F 9534            224     SUBB A,SO2
0171 FD              225     MOV R5,A
0172 24F6            226     ADD A,#246
0174 4030            227     JC TWODIGIT
0176 ED              228     MOV A,R5
0177 2430            229     ADD A,#48
0179 31DD            230     ACALL LCD_DATA
017B 8028            231     JMP DONE1
017D                 232     NHAN:
017D B4FA12          233     CJNE A,#250,CHIA
0180 E532            234     MOV A,SO1
0182 8534F0          235     MOV B,SO2
0185 A4              236     MUL AB
0186 FD              237     MOV R5,A
0187 24F6            238     ADD A,#246
0189 401B            239     JC TWODIGIT
018B ED              240     MOV A,R5
018C 2430            241     ADD A,#48
018E 31DD            242     ACALL LCD_DATA
0190 8013            243     JMP DONE1
0192                 244     CHIA:
0192 B4FF10          245     CJNE A,#255,DONE1
0195 E532            246     MOV A,SO1
0197 8534F0          247     MOV B,SO2
019A 84              248     DIV AB
019B FD              249     MOV R5,A
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     5

019C 24F6            250     ADD A,#246
019E 4006            251     JC TWODIGIT
01A0 ED              252     MOV A,R5
01A1 2430            253     ADD A,#48
01A3 31DD            254     ACALL LCD_DATA  
01A5 22              255     DONE1: RET
                     256     
01A6                 257     TWODIGIT:
01A6 ED              258     MOV A, R5
01A7 75F00A          259     MOV B, #10      
01AA 84              260     DIV AB          ; A = A / 10 (thuong), B = A % 10 (sO du)
01AB 2430            261     ADD A, #48      
01AD 31DD            262     ACALL LCD_DATA
01AF E5F0            263     MOV A, B       
01B1 2430            264     ADD A, #48     
01B3 31DD            265     ACALL LCD_DATA
01B5 80EE            266     SJMP DONE1
                     267     
                     268     ;-----------------------
01B7                 269     LCD_INIT:
01B7 7400            270             MOV A,#00H
01B9 510E            271             ACALL LCD_CMD_4
01BB 7403            272             MOV A,#03H
01BD 510E            273             ACALL LCD_CMD_4
01BF 7402            274         MOV A,#02H         ; Kh?i t?o ch? d? 4-bit
01C1 510E            275         ACALL LCD_CMD_4
01C3 7428            276         MOV A,#28H         ; 4-bit, 2 dòng, font 5x7
01C5 31D4            277         ACALL LCD_CMD
01C7 740C            278         MOV A,#0CH         ; Hi?n th? ON, t?t con tr?
01C9 31D4            279         ACALL LCD_CMD
01CB 7406            280         MOV A,#06H         ; T? d?ng tang, không d?ch màn hình
01CD 31D4            281         ACALL LCD_CMD
01CF 7401            282         MOV A,#01H         ; Xóa màn hình
01D1 31D4            283         ACALL LCD_CMD
01D3 22              284         RET
                     285     
                     286     ;-----------------------
01D4                 287     LCD_CMD:
01D4 C290            288         CLR RS
01D6 C291            289         CLR RW
01D8 31E6            290         ACALL SEND_4BIT
01DA 512F            291             ACALL SHORT_DELAY
01DC 22              292         RET
                     293     
01DD                 294     LCD_DATA:
01DD D290            295         SETB RS
01DF C291            296         CLR RW
01E1 31E6            297         ACALL SEND_4BIT
01E3 512F            298             ACALL SHORT_DELAY
01E5 22              299         RET
                     300     
01E6                 301     SEND_4BIT:
01E6 F8              302         MOV R0, A         ; ? Luu b?n g?c A (8-bit c?n g?i)x
                     303     
                     304         ; G?i nibble cao
01E7 54F0            305         ANL A, #0F0H
01E9 F9              306         MOV R1, A
01EA E5B0            307         MOV A, PORT
01EC 540F            308         ANL A, #0FH
01EE 49              309         ORL A, R1
01EF F5B0            310         MOV PORT, A
01F1 D292            311         SETB EN
01F3 5126            312         ACALL DELAYLCD
01F5 C292            313         CLR EN
01F7 5126            314         ACALL DELAYLCD
                     315     
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     6

                     316         ; G?i nibble th?p
01F9 E8              317         MOV A, R0         ; ? L?y l?i b?n g?c
01FA C4              318         SWAP A
01FB 54F0            319         ANL A, #0F0H
01FD F9              320         MOV R1, A
01FE E5B0            321         MOV A, PORT
0200 540F            322         ANL A, #0FH
0202 49              323         ORL A, R1
0203 F5B0            324         MOV PORT, A
0205 D292            325         SETB EN
0207 5126            326         ACALL DELAYLCD
0209 C292            327         CLR EN
020B 5126            328         ACALL DELAYLCD
020D 22              329         RET
                     330     
020E                 331     LCD_CMD_4:
                     332         ; Dùng d? kh?i t?o 4-bit (ch? g?i nibble cao)
020E C290            333             clr RS
0210 C291            334             clr RW
0212 C4              335             SWAP A
0213 54F0            336         ANL A, #0F0H
0215 F9              337         MOV R1, A
0216 E5B0            338         MOV A, PORT
0218 540F            339         ANL A, #0FH
021A 49              340         ORL A, R1
021B F5B0            341         MOV PORT, A
021D D292            342         SETB EN
021F 5126            343         ACALL DELAYLCD
0221 C292            344         CLR EN
0223 5126            345         ACALL DELAYLCD
0225 22              346         RET
                     347     
                     348     ;-----------------------
0226                 349     DELAYLCD:                                               ; delay 102ms
0226 7AC8            350         MOV R2,#200
0228 79FF            351     D1: MOV R1,#255
022A D9FE            352     D2: DJNZ R1,D2
022C DAFA            353         DJNZ R2,D1
022E 22              354         RET
022F                 355     SHORT_DELAY:
022F 7F0A            356         MOV R7, #10   
0231                 357     SD_LOOP:
0231 DFFE            358         DJNZ R7, SD_LOOP
0233 22              359         RET
                     360     ;-----------------------
                     361     
0234                 362     delay:                                                                  ;CHUONG TRINH CON D
                             ELAY 500MS
0234 758910          363     MOV TMOD,#10H
0237 7F0A            364     MOV R7,#10
0239                 365     LOOP:
0239 758D3C          366     MOV TH1,#HIGH(-50000)
023C 758BB0          367     MOV TL1,#LOW(-50000)
023F D28E            368     SETB TR1
0241 308FFD          369     JNB TF1,$
0244 C28E            370     CLR TR1
0246 C28F            371     CLR TF1
0248 DFEF            372     DJNZ R7,LOOP
024A 22              373     RET
                     374          
                     375     END
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     7

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . .  D ADDR   00E0H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
C1 . . . . . . . .  C ADDR   00EAH   A   
C10. . . . . . . .  C ADDR   0114H   A   
C11. . . . . . . .  C ADDR   011AH   A   
C13. . . . . . . .  C ADDR   0120H   A   
C14. . . . . . . .  C ADDR   0126H   A   
C15. . . . . . . .  C ADDR   012CH   A   
C2 . . . . . . . .  C ADDR   00F2H   A   
C3 . . . . . . . .  C ADDR   00FAH   A   
C7 . . . . . . . .  C ADDR   0102H   A   
C8 . . . . . . . .  C ADDR   0108H   A   
C9 . . . . . . . .  C ADDR   010EH   A   
CAL. . . . . . . .  C ADDR   013FH   A   
CHECK_COL. . . . .  C ADDR   00BCH   A   
CHECK_COL2 . . . .  C ADDR   00C4H   A   
CHECK_COL3 . . . .  C ADDR   00CCH   A   
CHECK_COL4 . . . .  C ADDR   00D4H   A   
CHIA . . . . . . .  C ADDR   0192H   A   
COL. . . . . . . .  N NUMB   003CH   A   
COL1 . . . . . . .  B ADDR   00A0H.0 A   
COL2 . . . . . . .  B ADDR   00A0H.1 A   
COL3 . . . . . . .  B ADDR   00A0H.2 A   
COL4 . . . . . . .  B ADDR   00A0H.3 A   
D1 . . . . . . . .  C ADDR   0228H   A   
D2 . . . . . . . .  C ADDR   022AH   A   
DAU. . . . . . . .  N NUMB   0038H   A   
DECODE . . . . . .  C ADDR   00E0H   A   
DELAY. . . . . . .  C ADDR   0234H   A   
DELAYLCD . . . . .  C ADDR   0226H   A   
DONE . . . . . . .  C ADDR   0132H   A   
DONE1. . . . . . .  C ADDR   01A5H   A   
EN . . . . . . . .  B ADDR   0090H.2 A   
FIN. . . . . . . .  C ADDR   0151H   A   
FINISH . . . . . .  C ADDR   00DFH   A   
INDEX. . . . . . .  N NUMB   0036H   A   
KEYPAD . . . . . .  C ADDR   006EH   A   
LCD_CMD. . . . . .  C ADDR   01D4H   A   
LCD_CMD_4. . . . .  C ADDR   020EH   A   
LCD_DATA . . . . .  C ADDR   01DDH   A   
LCD_INIT . . . . .  C ADDR   01B7H   A   
LOOP . . . . . . .  C ADDR   0239H   A   
MAIN . . . . . . .  C ADDR   0040H   A   
NHAN . . . . . . .  C ADDR   017DH   A   
NO_COL . . . . . .  C ADDR   00DCH   A   
NUM2 . . . . . . .  C ADDR   0149H   A   
OK . . . . . . . .  C ADDR   00BBH   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
PORT . . . . . . .  D ADDR   00B0H   A   
QUETPHIM . . . . .  C ADDR   0056H   A   
ROW1 . . . . . . .  B ADDR   00A0H.4 A   
ROW2 . . . . . . .  B ADDR   00A0H.5 A   
ROW3 . . . . . . .  B ADDR   00A0H.6 A   
ROW4 . . . . . . .  B ADDR   00A0H.7 A   
RS . . . . . . . .  B ADDR   0090H.0 A   
RW . . . . . . . .  B ADDR   0090H.1 A   
SAVENUM. . . . . .  C ADDR   0133H   A   
SD_LOOP. . . . . .  C ADDR   0231H   A   
A51 MACRO ASSEMBLER  MAIN                                                                 05/28/2025 14:58:08 PAGE     8

SEND_4BIT. . . . .  C ADDR   01E6H   A   
SHORT_DELAY. . . .  C ADDR   022FH   A   
SO1. . . . . . . .  N NUMB   0032H   A   
SO2. . . . . . . .  N NUMB   0034H   A   
SONHAP . . . . . .  N NUMB   003AH   A   
START. . . . . . .  C ADDR   0030H   A   
TF1. . . . . . . .  B ADDR   0088H.7 A   
TH1. . . . . . . .  D ADDR   008DH   A   
TINHTOAN . . . . .  C ADDR   0152H   A   
TL1. . . . . . . .  D ADDR   008BH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TO_ROW2. . . . . .  C ADDR   0081H   A   
TO_ROW3. . . . . .  C ADDR   0095H   A   
TO_ROW4. . . . . .  C ADDR   00A9H   A   
TR1. . . . . . . .  B ADDR   0088H.6 A   
TRU. . . . . . . .  C ADDR   016AH   A   
TWODIGIT . . . . .  C ADDR   01A6H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
